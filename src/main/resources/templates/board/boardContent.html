<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
                xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
                layout:decorate="~{layouts/basicLayout}">

<th:block layout:fragment="script">
  <script th:inline="javascript">

    // ëŒ“ê¸€ ë‹¬ê¸°
    function replyCheck() {
      let content = $("#content").val();
      if(content.trim() == "") {
        alert("ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”");
        $("#content").focus();
        return false;
      }
      let query = {
        boardId : [[${board.id}]],
        name : [[${session.sName}]],
        content : content
      }

      $.ajax({
        url : 'boardReplyInput',
        type: 'post',
        data: query,
        //beforeSend: function(xhr) { xhr.setRequestHeader(header, token); },
        success: (res) => {
          if(res != 0) {
            alert('ëŒ“ê¸€ì´ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            location.reload();
          }
        },
        error : () => alert('ì „ì†¡ì˜¤ë¥˜')
      });
    }

    // ëŒ“ê¸€ ì‚­ì œ
    function replyDeleteCheck(id) {
    	let ans = confirm("ì„ íƒí•œ ëŒ“ê¸€ì„ ì‚­ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
    	if(!ans) return false;

    	$.ajax({
    		url  : "boardReplyDelete",
    		type : "get",
    		data : {
    			id : id,
    		},
    		success:function() {
          location.reload();
    		},
    		error : function() { alert("ì „ì†¡ì˜¤ë¥˜!"); }
    	});
    }

    // ëŒ“ê¸€ ìˆ˜ì •í¼ ë³´ì—¬ì£¼ê¸°
    function replyUpdateCheck(id) {
    	$(".replyUpdateForm").hide();
    	$("#replyUpdateForm"+id).show();
    }

    // ëŒ“ê¸€ ìˆ˜ì •ì°½ ë‹«ê¸°
    function replyUpdateViewClose(id) {
    	$("#replyUpdateForm"+id).hide();
    }

    // ëŒ“ê¸€ ìˆ˜ì •í•˜ê¸°
    function replyUpdateCheckOk(id) {
    	let content = $("#content"+id).val();
    	if(content.trim() == "") {
    		alert("ìˆ˜ì •í•  ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”");
    		return false;
    	}
    	let query = {
        id : id,
        content : content
    	}

    	$.ajax({
    		url  : "boardReplyUpdateCheckOk",
    		type : "post",
    		data : query,
    		//beforeSend: function(xhr) { xhr.setRequestHeader(header, token); },
    		success:() => {
          alert("ëŒ“ê¸€ì´ ìˆ˜ì • ë˜ì—ˆìŠµë‹ˆë‹¤.");
          location.reload();
    		},
    		error : () => { alert("ì „ì†¡ì˜¤ë¥˜!") }
    	});
    }

    // í˜„ì¬ê¸€ ì‚­ì œì²˜ë¦¬
    function delCheck() {
      let ans = confirm("í˜„ì¬ ê²Œì‹œê¸€ì„ ì‚­ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
      if(ans) {
        let id = [[${board.id}]];
        let pag = [[${pageVO.pag}]];
        location.href = 'boardDelete?id='+id+'&pag='+pag;
      }
    }

    // ì¢‹ì•„ìš” ì²˜ë¦¬(ì¤‘ë³µ ë¶ˆí—ˆ)
    function goodCheck() {
      let id = [[${board.id}]];
    	$.ajax({
    		url  : 'boardGoodCheck',
    		type : 'post',
    		data : {id : id},
    		//beforeSend: function(xhr) { xhr.setRequestHeader(header, token); },
    		success:function(res) {
    			if(res != 0) alert("ì´ë¯¸ ì¢‹ì•„ìš”ë¥¼ í´ë¦­í•˜ì…¨ìŠµë‹ˆë‹¤.");
    			else location.reload();
    		},
    		error : function() { alert("ì „ì†¡ì˜¤ë¥˜!!"); }
    	});
    }

    // ì¢‹ì•„ìš”(ë”°ë´‰) ì²˜ë¦¬(ì¤‘ë³µ í—ˆìš©)
    function goodCheckPlus() {
      let id = [[${board.id}]];
    	$.ajax({
    		url  : 'boardGoodCheckPlusMinus',
    		type : 'post',
    		//beforeSend: function(xhr) { xhr.setRequestHeader(header, token); },
    		data : {
    			id : id,
    			goodCnt : 1
    		},
    		success:function() {
    			location.reload();
    		},
    		error : function() { alert("ì „ì†¡ì˜¤ë¥˜!!"); }
    	});
    }

    // ì‹«ì–´ìš” ì²˜ë¦¬(ì¤‘ë³µ í—ˆìš©)
    function goodCheckMinus() {
      let id = [[${board.id}]];
    	$.ajax({
    		url  : 'boardGoodCheckPlusMinus',
    		type : 'post',
    		//beforeSend: function(xhr) { xhr.setRequestHeader(header, token); },
    		data : {
    			id : id,
    			goodCnt : -1
    		},
    		success:function() {
    			location.reload();
    		},
    		error : function() { alert("ì „ì†¡ì˜¤ë¥˜!!"); }
    	});
    }

  </script>
</th:block>


<div layout:fragment="content">

  <h2 class="text-center mb-4">ê¸€ ë‚´ìš© ë³´ê¸°</h2>
  <th:block th:if="${board.complaint == 'HI'}">
    <hr class="border border-dark">
    <h3 class="text-center text-danger">í•´ë‹¹ ê²Œì‹œê¸€ì€ ì‹ ê³ ëœ ê¸€ì…ë‹ˆë‹¤.</h3>
    <hr class="border border-dark">
    <div class="text-center"><input type="button" value="ëŒì•„ê°€ê¸°" onclick="location.href='boardList?pag=${pag}&pageSize=${pageSize}&search=${search}&searchString=${searchString}'" class="btn btn-info"/></div>
  </th:block>
  <th:block th:if="${board.complaint != 'HI'}">
    <table class="table table-bordered text-center border-secondary-subtle">
      <tr>
        <th class="table-secondary">ê¸€ì“´ì´</th>
        <td>[[${board.name}]]</td>
        <th class="table-secondary">ê¸€ì“´ë‚ ì§œ</th>
        <td>[[${#strings.substring(board.wDate,0,19)}]]</td>
      </tr>
      <tr>
        <th class="table-secondary">ê¸€ì¡°íšŒìˆ˜</th>
        <td>[[${board.readNum}]]</td>
        <th class="table-secondary">ì ‘ì†IP</th>
        <td>[[${board.hostIp}]]</td>
      </tr>
      <tr>
        <th class="table-secondary">ê¸€ì œëª©</th>
        <td colspan="3" class="text-start">[[${board.title}]]
          (<a th:href="|javascript:goodCheck()|" title="ì¢‹ì•„ìš”">â¤</a>([[${board.good}]]))
          (<a th:href="|javascript:goodCheckPlus(1)|" title="ì¢‹ì•„ìš”">ğŸ‘</a>
          <a th:href="|javascript:goodCheckMinus(-1)|" title="ì‹«ì–´ìš”">ğŸ‘</a>([[${board.good}]]))
        </td>
      </tr>
      <tr>
        <th class="table-secondary">ê¸€ë‚´ìš©</th>
        <td colspan="3" style="height:250px" class="text-start" th:utext="${#strings.replace(board.content, newLine, '<br/>')}"></td>
      </tr>
    </table>
    <div class="row">
      <div class="col text-start"><input type="button" value="ëŒì•„ê°€ê¸°" th:onclick="|location.href='@{boardList(pag=${pageVO.pag-1},pageSize=${pageVO.pageSize},search=${pageVO.search},searchString=${pageVO.searchString})}'|" class="btn btn-info"/></div>
      <div class="col">
        <th:block th:if="${session.sName != board.name && board.complaint == 'NO'}"><a href="#" data-bs-toggle="modal" data-bs-target="#myModal" class="btn btn-danger">ì‹ ê³ í•˜ê¸°</a></th:block>
        <th:block th:if="${board.complaint == 'OK'}"><font color="red"><b>í˜„ì¬ ê²Œì‹œê¸€ì€ ì‹ ê³ ëœ ê¸€ì…ë‹ˆë‹¤.</b></font></th:block>
      </div>
      <!--<th:block th:if="${session.sName == board.name || session.strLevel == 'ê´€ë¦¬ì'}">-->
        <div class="col text-end">
          <!--<th:block sec:authorize="isAuthenticated()">-->
            <!--<th:block th:if="${#authentication != null and board != null board.email != null and #authentication.name eq board.email}">-->
            <th:block th:if="${pageVO.isOwner}">
              <input type="button" value="ìˆ˜ì •" th:onclick="|location.href='boardUpdate(id=${board.id},pag=${pag},pageSize=${pageSize},search=${search},searchString=${searchString}'|" class="btn btn-warning"/>
              <input type="button" value="ì‚­ì œ" onclick="delCheck()" class="btn btn-danger"/>
            </th:block>
          <!--</th:block>-->
        </div>
      <!--</th:block>-->
    </div>
  </th:block>

  <hr/>
  <!-- ì´ì „ê¸€/ë‹¤ìŒê¸€ -->
  <div class="row">
    <div class="col text-start">
      <th:block th:if="${!#strings.isEmpty(nextVO)}">
        ğŸ‘† <a th:href="@{boardContent(id=${nextVO.id},pag=${pageVO.pag},pageSize=${pageVO.pageSize})}">ë‹¤ìŒê¸€ : [[${nextVO.title}]]</a><br/>
      </th:block>
      <th:block th:if="${!#strings.isEmpty(preVO)}">
        ğŸ‘‡ <a th:href="@{boardContent(id=${preVO.id},pag=${pageVO.pag},pageSize=${pageVO.pageSize})}">ì´ì „ê¸€ : [[${preVO.title}]]</a><br/>
      </th:block>
    </div>
  </div>
  <hr/>

  <!-- ëŒ“ê¸€ì²˜ë¦¬(ë¦¬ìŠ¤íŠ¸/ì…ë ¥) -->
  <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
  <table class="table table-hover text-center">
    <tr class="table-secondary">
      <th>ì‘ì„±ì</th>
      <th>ëŒ“ê¸€ë‚´ìš©</th>
      <th>ëŒ“ê¸€ì¼ì</th>
      <th>ì ‘ì†IP</th>
    </tr>
    <th:block th:each="replyVO, st : ${replyVos}">
      <tr>
        <td>
          <!--<span th:text="${replyVO.name}"></span>-->
          [[${replyVO.name}]]
          <th:block th:if="${session.sName eq replyVO.name || strLevel eq 'ê´€ë¦¬ì'}">
            (<a th:href="|javascript:replyDeleteCheck(${replyVO.id})|" title="ëŒ“ê¸€ì‚­ì œ">x</a>)
            <th:block th:if="${session.sName eq replyVO.name}">
              (<a th:href="|javascript:replyUpdateCheck(${replyVO.id})|" title="ëŒ“ê¸€ìˆ˜ì •">âˆš</a>)
            </th:block>
          </th:block>
        </td>
        <!--<td class="text-start" th:utext="${#strings.replace(replyVO.content, newLine, '&lt;br/&gt;')}" style="white-space: pre-line;" ></td>-->
        <td class="text-start" th:utext="${replyVO.content}" style="white-space: pre-line;" ></td>
        <td th:text="${#strings.substring(replyVO.wDate, 0, 10)}"></td>
        <td th:text="${replyVO.hostIp}"></td>
      </tr>
      <!-- ì•„ë˜ë¡œ ëŒ“ê¸€ ìˆ˜ì • í¼ ë³´ê¸° -->
      <tr class="border-light">
        <td colspan="4" class="m-0 p-0">
          <div th:id="replyUpdateForm+${replyVO.id}" class="replyUpdateForm m-0 p-0" style="display:none;">
            <form name="replyUpdateForm">
              <table class="table text-center">
                <tr>
                  <td class="text-start" style="width:85%">
                    ê¸€ë‚´ìš© :
                    <textarea rows="4" name="content" th:id="content+${replyVO.id}" class="form-control">[[${replyVO.content}]]</textarea>
                  </td>
                  <td style="width:15%"><br/>
                    <p>ì‘ì„±ì : [[${session.sName}]]</p>
                    <p>
                      <a th:href="|javascript:replyUpdateCheckOk(${replyVO.id})|" class="badge bg-primary">ëŒ“ê¸€ìˆ˜ì •</a>
                      <a th:href="|javascript:replyUpdateViewClose(${replyVO.id})|" class="badge bg-warning">ì°½ë‹«ê¸°</a>
                    </p>
                  </td>
                </tr>
              </table>
            </form>
          </div>
        </td>
      </tr>
    </th:block>
  </table>
  <hr/>

  <!-- ëŒ“ê¸€ ì…ë ¥ì°½ -->
  <form name="replyForm">
    <table class="table text-center">
      <tr>
        <td class="text-start" style="width:85%">
          ê¸€ë‚´ìš© :
          <textarea rows="4" name="content" id="content" class="form-control"></textarea>
        </td>
        <td style="width:15%"><br/>
          <p>ì‘ì„±ì : [[${sName}]]</p>
          <p><input type="button" value="ëŒ“ê¸€ë‹¬ê¸°" onclick="replyCheck()" class="btn btn-info btn-sm"/></p>
        </td>
      </tr>
    </table>
    <!--
    <input type="hidden" name="_csrf" th:value="${_csrf.token}">
    <input type="hidden" name="_csrf_header" th:content="${_csrf.headerName}">
    -->
  </form>

</div>

</html>