<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
                xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
                layout:decorate="~{layouts/basicLayout}">

<th:block layout:fragment="script">
    <script th:inline="javascript">
        'use strict'

        let token;
        let header;

        $(document).ready(function() {
            token = $("input[name='_csrf']").val();
            header = $("input[name='_csrf_header']").attr("content");
        });

        function replyCheck() {
            let content = $("#content").val();
            if(content.trim() == "") {
                alert("ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”");
                $("#content").focus();
                return false;
            }
            let query = {
                boardId : [[${board.id}]],
                name : [[${session.sName}]],
                content : content
            }

            $.ajax({
                url : 'boardReplyInput',
                type : 'post',
                data : query,
                beforeSend: function(xhr) { xhr.setRequestHeader(header, token); },
                success: (res) => {
                    if(res != 0) {
                        alert('ëŒ“ê¸€ì´ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        location.reload();
                    }
                },
                error : () => alert('ì „ì†¡ì˜¤ë¥˜')
            })
        }
    </script>
</th:block>

<div layout:fragment="content">

  <h2 class="text-center mb-4">ê¸€ ë‚´ìš© ë³´ê¸°</h2>
  <th:block th:if="${board.complaint == 'HI'}">
    <hr class="border border-dark">
    <h3 class="text-center text-danger">í•´ë‹¹ ê²Œì‹œê¸€ì€ ì‹ ê³ ëœ ê¸€ì…ë‹ˆë‹¤.</h3>
    <hr class="border border-dark">
    <div class="text-center"><input type="button" value="ëŒì•„ê°€ê¸°" onclick="location.href='boardList?pag=${pag}&pageSize=${pageSize}&search=${search}&searchString=${searchString}'" class="btn btn-info"/></div>
  </th:block>
  <th:block th:if="${board.complaint != 'HI'}">
    <table class="table table-bordered text-center border-secondary-subtle">
      <tr>
        <th class="table-secondary">ê¸€ì“´ì´</th>
        <td>[[${board.name}]]</td>
        <th class="table-secondary">ê¸€ì“´ë‚ ì§œ</th>
        <td>[[${#strings.substring(board.wDate,0,19)}]]</td>
      </tr>
      <tr>
        <th class="table-secondary">ê¸€ì¡°íšŒìˆ˜</th>
        <td>[[${board.readNum}]]</td>
        <th class="table-secondary">ì ‘ì†IP</th>
        <td>[[${board.hostIp}]]</td>
      </tr>
      <tr>
        <th class="table-secondary">ê¸€ì œëª©</th>
        <td colspan="3" class="text-start">[[${board.title}]]
          (<a th:href="|javascript:goodCheck1()|" title="ì¢‹ì•„ìš”">â¤</a>([[${board.good}]]))
          (<a th:href="|javascript:goodCheck2(1)|" title="ì¢‹ì•„ìš”">ğŸ‘</a>
          <a th:href="|javascript:goodCheck2(-1)|" title="ì‹«ì–´ìš”">ğŸ‘</a>([[${board.good}]]))
        </td>
      </tr>
      <tr>
        <th class="table-secondary">ê¸€ë‚´ìš©</th>
        <td colspan="3" style="height:250px" class="text-start" th:utext="${#strings.replace(board.content, newLine, '<br/>')}"></td>
      </tr>
    </table>
    <div class="row">
      <div class="col"><input type="button" value="ëŒì•„ê°€ê¸°" th:onclick="|location.href='@{boardList(pag=${pageVO.pag-1},pageSize=${pageVO.pageSize},search=${pageVO.search},searchString=${pageVO.searchString})}'|" class="btn btn-info"/></div>
      <div class="col">
        <th:block th:if="${session.sName != board.name && board.complaint == 'NO'}"><a href="#" data-bs-toggle="modal" data-bs-target="#myModal" class="btn btn-danger">ì‹ ê³ í•˜ê¸°</a></th:block>
        <th:block th:if="${board.complaint == 'OK'}"><font color="red"><b>í˜„ì¬ ê²Œì‹œê¸€ì€ ì‹ ê³ ëœ ê¸€ì…ë‹ˆë‹¤.</b></font></th:block>
      </div>
      <th:block th:if="${session.sName == board.name || session.strLevel == 'ê´€ë¦¬ì'}">
        <div class="col text-end">
          <th:block th:if="${session.sName == board.name}">
            <input type="button" value="ìˆ˜ì •" th:onclick="|location.href='@{boardUpdate(id=${board.id},pag=${pageVO.pag},pageSize=${pageVO.pageSize})}'|" class="btn btn-warning"/>
          </th:block>
            <input type="button" value="ì‚­ì œ" th:onclick="|if (confirm('ì •ë§ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {location.href='@{boardDelete(id=${board.id})}'}|" class="btn btn-danger"/>
        </div>
      </th:block>
    </div>
  </th:block>

  <hr/>
  <!-- ì´ì „ê¸€/ë‹¤ìŒê¸€ -->
  <div class="row">
    <div class="col text-start">
      <th:block th:if="${nextVO != null}">
        ğŸ‘† <a th:href="@{boardContent(id=${nextVO.id},pag=${pageVO.pag},pageSize=${pageVO.pageSize})}">ë‹¤ìŒê¸€ : [[${nextVO.title}]]</a><br/>
      </th:block>
      <th:block th:if="${preVO != null}">
        ğŸ‘‡ <a th:href="@{boardContent(id=${preVO.id},pag=${pageVO.pag},pageSize=${pageVO.pageSize})}">ì´ì „ê¸€ : [[${preVO.title}]]</a><br/>
      </th:block>
    </div>
  </div>
  <hr/>

  <!-- ëŒ“ê¸€ì²˜ë¦¬(ë¦¬ìŠ¤íŠ¸/ì…ë ¥) -->
  <!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
  <table class="table table-hover text-center">
    <tr class="table-secondary">
      <th>ì‘ì„±ì</th>
      <th>ëŒ“ê¸€ë‚´ìš©</th>
      <th>ëŒ“ê¸€ì¼ì</th>
      <th>ì ‘ì†IP</th>
    </tr>
    <th:block th:each="replyVO, st : ${replyVos}">
      <tr>
        <td>[[${replyVO.name}]]
          <th:block th:if="${sMid == replyVO.name || sLevel == 0}">
            (<a th:href="|javascript:replyDeleteCheck(${replyVO.id})|" title="ëŒ“ê¸€ì‚­ì œ">x</a>)
            <th:block th:if="${sMid == replyVO.name}">
              (<a th:href="|javascript:replyUpdateCheck(${replyVO.id})|" title="ëŒ“ê¸€ìˆ˜ì •">âˆš</a>)
            </th:block>
          </th:block>
        </td>
        <td class="text-start" th:utext="${#strings.replace(replyVO.content, newLine, '<br/>')}"></td>
        <td>[[${#strings.substring(replyVO.wDate, 0, 10)}]]</td>
        <td>[[${replyVO.hostIp}]]</td>
      </tr>
      <!-- ì•„ë˜ë¡œ ëŒ“ê¸€ ìˆ˜ì • í¼ ë³´ê¸° -->
      <tr style="display:none">
        <td colspan="4">
          <div id="replyUpdateForm${replyVO.id}" class="replyUpdateForm">
            <form name="replyUpdateForm">
              <table class="table text-center">
                <tr>
                  <td class="text-start" style="width:85%">
                    ê¸€ë‚´ìš© :
                    <textarea rows="4" name="content" id="content${replyVO.id}" class="form-control">[[${replyVO.content}]]</textarea>
                  </td>
                  <td style="width:15%"><br/>
                    <p>ì‘ì„±ì : [[${sName}]]</p>
                    <p>
                      <a th:href="|javascript:replyUpdateCheckOk(${replyVO.id})|" class="badge bg-primary">ëŒ“ê¸€ìˆ˜ì •</a>
                      <a th:href="|javascript:replyUpdateViewClose(${replyVO.id})|" class="badge bg-warning">ì°½ë‹«ê¸°</a>
                    </p>
                  </td>
                </tr>
              </table>
            </form>
          </div>
        </td>
      </tr>
    </th:block>
  </table>
  <hr/>

  <!-- ëŒ“ê¸€ ì…ë ¥ì°½ -->
  <form name="replyForm">
    <table class="table text-center">
      <tr>
        <td class="text-start" style="width:85%">
          ê¸€ë‚´ìš© :
          <textarea rows="4" name="content" id="content" class="form-control"></textarea>
        </td>
        <td style="width:15%"><br/>
          <p>ì‘ì„±ì : [[${sName}]]</p>
          <p><input type="button" value="ëŒ“ê¸€ë‹¬ê¸°" onclick="replyCheck()" class="btn btn-info btn-sm"/></p>
        </td>
      </tr>
    </table>
      <input type="hidden" name="_csrf" th:value="${_csrf.token}">
      <input type="hidden" name="_csrf_header" th:content="${_csrf.headerName}">
  </form>

</div>

</html>